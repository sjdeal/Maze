<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
<title>Maze</title>


<script id="vertex-shader" type="x-shader/x-vertex">
attribute vec4 vPosition;
attribute vec3 vNormal;
attribute vec2 vTexCoord;

varying vec3 fN;
varying vec3 fE;
varying vec3 fL;
varying vec2 fTexCoord;

uniform mat4 model_view;
uniform mat4 projection;
uniform mat3 normal_mat;
uniform vec4 light_position;

void main()
{
  vec4 ecPosition = model_view * vPosition;

  fN = normal_mat * vNormal;
  fE = -ecPosition.xyz;
  if (light_position.w == 0.0) {
    fL = light_position.xyz;
  } else {
    fL = light_position.xyz - ecPosition.xyz;
  }

  fTexCoord = vTexCoord;

  gl_Position = projection * ecPosition;
} 
</script>

<script id="fragment-shader" type="x-shader/x-fragment">
precision mediump float;
   
varying vec3 fN;
varying vec3 fL;
varying vec3 fE;
varying vec2 fTexCoord;

uniform vec4 ambient_product, diffuse_product, specular_product;
uniform float shininess;

uniform int toggleLocal;
uniform int toggleDist;

uniform sampler2D texture;

void main()
{
  vec3 N = normalize(fN);
  vec3 E = normalize(fE);
  vec3 L = normalize(fL);
  vec3 H = normalize(L + E);

  float Kd = max(dot(L, N), 0.0);
  float Ks = pow(max(dot(N, H), 0.0), shininess);

  vec4 ambient  = ambient_product;
  vec4 diffuse  = Kd * diffuse_product;
  vec4 specular = Ks * specular_product;
  if (dot(L, N) < 0.0) {
    specular = vec4(0.0, 0.0, 0.0, 1.0);
  }

  vec4 fColor;
  fColor  = (ambient + diffuse) * texture2D(texture, fTexCoord) + specular;
  
  fColor.a     = 1.0;
  gl_FragColor = fColor;
}
</script>


<!--
  Source the common scripts and the script for this program
-->
<script type="text/javascript" src="../Common/webgl-utils.js"></script>
<script type="text/javascript" src="../Common/initShaders.js"></script>
<script type="text/javascript" src="../Common/MV.js"></script>
<script type="text/javascript" src="../Common/bezierPointsNormals Tex.js"></script>
<script type="text/javascript" src="dealShapes.js"></script>
<script type="text/javascript" src="dealTextures.js"></script>
<script type="text/javascript" src="maze.js"></script>
<script type="text/javascript" src="mazeLayout.js"></script>
</head>


<body onkeypress="keyPressed(event)">

<!--
  Create the canvas for this program
-->
<canvas id="gl-canvas" width="1900" height="1055">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>

</body>
</html>
